"use strict";var _mainModules=["Services","Directives","ngRoute","ngResource","Header","Login","Expenses","infinite-scroll","InvoiceExpenseImage","Api"];angular.module("app",_mainModules).config(["$routeProvider","$httpProvider",function(a,b){a.otherwise({redirectTo:"/login"});var c=[];c.push({name:"/login",params:{templateUrl:"./scripts/login/views/login.html",controller:"LoginCtrl"}}),c.push({name:"/expenses",params:{templateUrl:"scripts/expenses/views/expenses.html",controller:"ExpensesListCtrl"}}),c.push({name:"/invoice-expense-image",params:{templateUrl:"scripts/invoice_expense_image/views/invoice-image-details.html",controller:"InvoiceImageCtrl"}}),c.push({name:"/add-expense",params:{templateUrl:"scripts/expenses/views/add-edit-expense.html",controller:"AddExpenseCtrl"}}),c.push({name:"/edit-expense",params:{templateUrl:"scripts/expenses/views/add-edit-expense.html",controller:"EditExpenseCtrl"}}),c.push({name:"/reports",params:{templateUrl:"scripts/expenses/views/send-expenses-report.html",controller:"LoginCtrl"}}),c.push({name:"/settings",params:{templateUrl:"scripts/expenses/views/settings.html",controller:"LoginCtrl"}}),c.forEach(function(b){a.when(b.name,b.params)});var d,e=["$q","$injector",function(a,b){function c(a){return d=d||b.get("$http"),d.pendingRequests.length<1&&(f=f||b.get("requestNotificationChannelSvc"),f.requestEnded()),a}function e(c){return d=d||b.get("$http"),d.pendingRequests.length<1&&(f=f||b.get("requestNotificationChannelSvc"),f.requestEnded()),a.reject(c)}var f;return function(a){return f=f||b.get("requestNotificationChannelSvc"),f.requestStarted(),a.then(c,e)}}];b.responseInterceptors.push(e)}]).run(["currenciesRepositorySvc","currenciesSvc","expenseTypesRepositorySvc","expenseTypesSvc",function(a,b,c,d){a.getCurrencies().$promise.then(function(a){b.set(a.currencies)}),c.getExpenseTypes().$promise.then(function(a){d.set(a.expenseTypes)})}]),angular.module("Login",["ngResource"]).config(function(){}).constant("errorMsg","Please try again! Username or password is wrong!"),angular.module("Login").factory("UserSvc",["$resource","baseUrlMockeyEmulator","loginUrl",function(a,b,c){return a(b+c,{},{login:{method:"POST"}})}]),angular.module("Header",[]).config(function(){}).constant("defaultMode","_DEFAULT_").constant("selectMode","_SELECT_").constant("selectModeActivated","_SELECT_MODE_ACTIVATED").constant("detailsModeActivated","_DETAILS_MODE_ACTIVATED").constant("addExpenseErrorMsg","Please complete all fields!"),angular.module("Expenses",[]).config(function(){}).constant("defaultMode","_DEFAULT_").constant("selectMode","_SELECT_").constant("selectModeActivated","_SELECT_MODE_ACTIVATED").constant("detailsModeActivated","_DETAILS_MODE_ACTIVATED").constant("addExpenseErrorMsg","Please complete all fields!").constant("addExpensesTitle","Add Expenses").constant("addExpensesButtonLabel","Add").constant("editExpensesTitle","Edit Expenses").constant("editExpensesButtonLabel","Edit"),angular.module("InvoiceExpenseImage",[]).config(function(){}),angular.module("Api",[]).config(function(){}).constant("baseUrl","https://esb.dev.corp.globant.com").constant("baseUrlMockeyWeb","http://127.0.0.1:8080").constant("baseUrlMockeyEmulator","http://10.0.3.2:8080").constant("loginUrl","/service/login").constant("expensesUrl","/service/expense/:image").constant("currenciesUrl","/service/currencies").constant("expenseTypesUrl","/service/expenseTypes"),angular.module("Header").controller("HeaderCtrl",["$scope","$filter","$location",function(a,b,c){a.active=c.$$path.indexOf("report")>0?!1:!0,a.switch=function(){a.active=!a.active,c.path(a.active===!1?"/reports":"/expenses")},a.addExpense=function(){c.path("/add-expense")}}]),angular.module("Login").controller("LoginCtrl",["$scope","$location","UserSvc","errorMsg","localStorageSvc",function(a,b,c,d,e){a.errorMessage=d,a.showErrorMessage=!1,a.login=function(d){function f(c){e.localStorageExists()?(a.showErrorMessage=!1,e.setItem("session-token",c.session_token),b.path("/expenses")):g()}function g(){a.showErrorMessage=!0,a.user.username="",a.user.password=""}c.login({username:d.username,password:d.password},f,g)}}]),angular.module("Expenses").controller("AddEditExpenseCtrl",["$scope","$location","expensesRepositorySvc","addExpenseErrorMsg","currenciesSvc","expenseTypesSvc",function(a,b,c,d,e,f){a.errorMessage=d,a.showErrorMessage=!1,a.currencies=e.get(),a.expenseTypes=f.get(),a.addOrEdit=function(d,e){function f(){a.showErrorMessage=!1,b.path("/expenses")}function g(){a.showErrorMessage=!0}d.$valid?(e.date=e.date||new Date,c.saveExpense(e,f,g)):a.showErrorMessage=!0}}]),angular.module("Expenses").controller("ExpensesListCtrl",["$scope","$filter","$location","expenseSvc","expensesBufferingSvc","defaultMode","selectMode","editExpenseSvc","cameraSvc",function(a,b,c,d,e,f,g,h,i){function j(b,c){a.expenses=m(a.expenses,b,c)}var k=f,l=!0;a.expenses=[],a.searchedExpense={},a.showSorting=!1,a.reverseSorting=!0,a.showSearch=!1,a.showDeleteMode=!1,a.takePhoto=function(){function b(b){a.imageSelectedPath=b}function c(a){alert("Failed because: "+a)}navigator.camera.getPicture(b,c,{quality:50,destinationType:Camera.DestinationType.FILE_URI,targetWidth:50,targetHeight:50})},a.showInvoiceImage=function(){c.path("/invoice-expense-image")},a.editExpense=function(a){h.setExpenseForEdit(a),c.path("/edit-expense")},a.selectMode=function(){return k===g},a.select=function(){},a.getMoreExpenses=function(){return l?void(l=!1):void e.getMoreExpenses(a).then(function(b){b.forEach(function(b){a.expenses.push(d.getExpense(a,b))})})},a.enableSorting=function(){a.showSorting=!0},a.sort=function(b){a.reverseSorting=b,j("date",b),a.showSorting=!1},a.toggleSearching=function(b){a.showSearch=b},a.takePhoto=function(a){i.takePhoto().then(function(){a.imageType="jpg"})};var m=b("orderBy");e.getExpenses(a).then(function(b){b.forEach(function(b){a.expenses.push(b)})})}]),angular.module("Expenses").controller("EditExpenseCtrl",["$scope","editExpensesTitle","editExpensesButtonLabel","editExpenseSvc","cameraSvc",function(a,b,c,d,e){a.title=b,a.buttonLabel=c,a.expense=d.getExpenseForEdit(),a.date=a.expense.date,a.imageSelectedPath="",a.takePhoto=function(){e.takePhoto().then(function(b){a.imageSelectedPath=b})}}]),angular.module("Expenses").controller("AddExpenseCtrl",["$scope","addExpensesTitle","addExpensesButtonLabel",function(a,b,c){a.title=b,a.buttonLabel=c,a.date=new Date}]),angular.module("InvoiceExpenseImage").controller("InvoiceImageCtrl",["$scope","expensesRepositorySvc",function(a,b){b.getImage({},{image:"image"}).$promise.then(function(b){a.invoiceImage=b.invoiceImage})}]),angular.module("AppConfig",[]).constant("foo","stagingFoo"),angular.module("Services",[]).config(function(){}).constant("currenciesUrl","https://esb.dev.corp.globant.com/currency").constant("currenciesUrlMockWeb","http://127.0.0.1:8080/service/currencies"),angular.module("Services").factory("localStorageSvc",[function(){function a(){return window.localStorage}function b(a,b){localStorage.setItem(a,b)}function c(a){return localStorage.getItem(a)}return{localStorageExists:a,setItem:b,getItem:c}}]),angular.module("Services").factory("requestNotificationChannelSvc",["$rootScope",function(a){var b="_START_REQUEST_",c="_END_REQUEST_",d=function(){a.$broadcast(b)},e=function(){a.$broadcast(c)},f=function(a,c){a.$on(b,function(){c()})},g=function(a,b){a.$on(c,function(){b()})};return{requestStarted:d,requestEnded:e,onRequestStarted:f,onRequestEnded:g}}]),angular.module("Services").factory("currenciesRepositorySvc",["$resource","baseUrlMockeyEmulator","currenciesUrl",function(a,b,c){return a(b+c,{},{getCurrencies:{method:"GET",isArray:!1}})}]),angular.module("Services").factory("currenciesSvc",[function(){function a(){return c}function b(a){c=a}var c=[];return{get:a,set:b}}]),angular.module("Services").factory("expenseTypesRepositorySvc",["$resource","baseUrlMockeyWeb","expenseTypesUrl",function(a,b,c){return a(b+c,{},{getExpenseTypes:{method:"GET",isArray:!1}})}]),angular.module("Services").factory("expenseTypesSvc",[function(){function a(){return c}function b(a){c=a}var c=[];return{get:a,set:b}}]),angular.module("Services").factory("cameraSvc",["$q",function(a){function b(){function b(a){confirm("Upload image to expense?")?d.resolve(a):d.reject()}function c(){alert("Fail"),d.reject()}var d=a.defer();return alert("navigator.camera is "+navigator.camera),navigator.camera.getPicture(b,c,{quality:50,targetWidth:100,targetHeight:100,destinationType:Camera.DestinationType.FILE_URI}),d.promise}return{takePhoto:b}}]),angular.module("Expenses").factory("expenseSvc",["expensesRequestNotificationChannelSvc","currenciesSvc","expenseTypesSvc",function(a,b,c){function d(d,e){function f(){var a=b.get();a.some(function(a){return a.id===k.originalCurrencyId?(k.currency=a,!0):void 0}),!k.currency}function g(){var a=c.get();a.some(function(a){return a.name===k.expenseTypeName?(k.expenseType=a,!0):void 0}),!k.expenseType}function h(){k.showDetails=!1}function i(a,b){k.expenseId!==a&&(b?(k.showDetails=!1,k.enabled=!1):k.enabled=!0)}function j(){f(),g(),a.onSelectModeActivated(d,h),a.onDetailsModeActivated(d,i)}var k=this;k.expenseId=e.expenseId,k.submiter=e.submiter,k.owner=e.owner,k.description=e.description,k.invoiceNumber=e.invoiceNumber,k.date=e.date,k.originalCurrencyId=e.originalCurrencyId,k.originalAmount=e.originalAmount,k.exchangeRate=e.exchangeRate,k.expenseTypeName=e.type,k.imageType=e.imageType,k.currency=null,k.expenseType=null,k.showDetails=!1,k.selected=!1,k.enabled=!0,j()}function e(a,b){return new d(a,b)}return d.prototype.toggleDetails=function(){this.enabled&&(this.selected=!1,this.showDetails=!this.showDetails,a.activateDetailsMode(this.expenseId,this.showDetails))},d.prototype.toggleSelect=function(){this.enabled&&!this.showDetails&&(this.selected=!this.selected)},{getExpense:e}}]),angular.module("Expenses").factory("expensesBufferingSvc",["expensesRepositorySvc","$q","expenseSvc",function(a,b,c){function d(d){var e=b.defer();return a.getExpenses().$promise.then(function(a){f=a.expenses.map(function(a){return c.getExpense(d,a)}),f=f.splice(0,4),e.resolve(f)}),e.promise}function e(a){var c=b.defer();return f.length>0?(g=f.splice(0,5),c.resolve(g)):d(a).then(function(a){c.resolve(a)}),c.promise}var f=[],g=[];return{getExpenses:d,getMoreExpenses:e}}]),angular.module("Expenses").factory("expensesRepositorySvc",["$resource","baseUrlMockeyEmulator","expensesUrl",function(a,b,c){return a(b+c,{image:"@image"},{getExpenses:{method:"GET",isArray:!1},getImage:{method:"GET",isArray:!1},saveExpense:{method:"POST"}})}]),angular.module("Expenses").factory("expensesRequestNotificationChannelSvc",["$rootScope","selectModeActivated","detailsModeActivated",function(a,b,c){var d=function(){a.$broadcast(b)},e=function(a,c){a.$on(b,function(){c()})},f=function(b,d){a.$broadcast(c,{expenseId:b,isAnotherExpenseOpened:d})},g=function(a,b){a.$on(c,function(a,c){b(c.expenseId,c.isAnotherExpenseOpened)})};return{activateSelectMode:d,onSelectModeActivated:e,activateDetailsMode:f,onDetailsModeActivated:g}}]),angular.module("Expenses").factory("editExpenseSvc",[function(){function a(){return c}function b(a){c=a}var c=null;return{getExpenseForEdit:a,setExpenseForEdit:b}}]),angular.module("Filters",[]).config(function(){}),angular.module("Directives",[]).config(function(){}),angular.module("Directives").directive("decimalPlaces",function(){return{link:function(a,b){b.bind("keypress",function(a){var b=$(this).val()+(0!==a.charCode?String.fromCharCode(a.charCode):"");0===$(this).val().search(/(.*)\.[0-9][0-9]/)&&b.length>$(this).val().length&&a.preventDefault()})}}}),angular.module("Directives").directive("loading",["requestNotificationChannelSvc",function(a){return{restrict:"E",replace:!0,template:'<div class="msg errorMsg loader"><img src="resources/images/ajax-loader.gif" />LOADING...</div>',link:function(b,c){c.hide();var d=function(){c.show()},e=function(){c.hide()};a.onRequestStarted(b,d),a.onRequestEnded(b,e)}}}]),angular.module("Directives").directive("stopEvent",function(){return{restrict:"A",link:function(a,b,c){b.bind(c.stopEvent,function(a){a.stopPropagation()})}}}),angular.module("Directives").directive("backButton",function(){return{restrict:"A",link:function(a,b){b.on("click",function(){history.back()})}}});