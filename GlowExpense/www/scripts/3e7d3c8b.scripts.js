"use strict";var _mainModules=["Services","Directives","ngRoute","ngResource","ngAnimate","ngTouch","Header","Login","Expenses","Reports","infinite-scroll","InvoiceExpenseImage","Api","Modals","ui.bootstrap"];angular.module("app",_mainModules).config(["$routeProvider","$httpProvider",function(a,b){a.otherwise({redirectTo:"/login"});var c=[];c.push({name:"/login",params:{templateUrl:"./scripts/login/views/login.html",controller:"LoginCtrl"}}),c.push({name:"/expenses",params:{templateUrl:"scripts/expenses/views/expenses.html",controller:"ExpensesListCtrl"}}),c.push({name:"/invoice-expense-image",params:{templateUrl:"scripts/invoice_expense_image/views/invoice-image-details.html",controller:"InvoiceImageCtrl"}}),c.push({name:"/add-expense",params:{templateUrl:"scripts/expenses/views/add-edit-expense.html",controller:"AddExpenseCtrl"}}),c.push({name:"/edit-expense",params:{templateUrl:"scripts/expenses/views/add-edit-expense.html",controller:"EditExpenseCtrl"}}),c.push({name:"/reports",params:{templateUrl:"scripts/reports/views/main-report-view.html",controller:"ReportsCtrl"}}),c.push({name:"/create-report",params:{templateUrl:"scripts/reports/views/create-report.html",controller:"CreateReportCtrl"}}),c.push({name:"/edit-report",params:{templateUrl:"scripts/reports/views/edit-report.html",controller:"EditReportCtrl"}}),c.push({name:"/view-report",params:{templateUrl:"scripts/reports/views/view-report.html",controller:"ViewReportCtrl"}}),c.push({name:"/settings",params:{templateUrl:"scripts/expenses/views/settings.html",controller:"LoginCtrl"}}),c.forEach(function(b){a.when(b.name,b.params)});var d,e=["$q","$injector",function(a,b){function c(a){return d=d||b.get("$http"),d.pendingRequests.length<1&&(f=f||b.get("requestNotificationChannelSvc"),f.requestEnded()),a}function e(c){return d=d||b.get("$http"),d.pendingRequests.length<1&&(f=f||b.get("requestNotificationChannelSvc"),f.requestEnded()),a.reject(c)}var f;return function(a){return f=f||b.get("requestNotificationChannelSvc"),f.requestStarted(),a.then(c,e)}}];b.responseInterceptors.push(e)}]).run(["currenciesRepositorySvc","currenciesSvc",function(a,b){a.getCurrencies().$promise.then(function(a){b.set(a.currencies)})}]),angular.module("Login",["ngResource"]).config(function(){}).constant("errorMsg","Please try again! Username or password is wrong!"),angular.module("Login").factory("UserSvc",["$resource","baseUrlMockeyWeb","loginUrl",function(a,b,c){return a(b+c,{},{login:{method:"POST"}})}]),angular.module("Header",[]).config(function(){}).constant("loginPath","/login"),angular.module("Expenses",[]).config(function(){}).constant("addExpenseErrorMsg","Please complete all fields!").constant("addExpensesTitle","Create Expenses").constant("addExpensesButtonLabel","Create").constant("editExpensesTitle","Edit Expense").constant("editExpensesButtonLabel","Save").constant("reportEntity","Expense"),angular.module("Reports",[]).config(function(){}).constant("addReportErrorMsg","Please complete all fields!").constant("entityName","Report"),angular.module("InvoiceExpenseImage",[]).config(function(){}),angular.module("Api",[]).config(function(){}).constant("baseUrl","https://esb.dev.corp.globant.com").constant("baseUrlMockeyWeb","http://10.0.3.2:8080").constant("baseUrlMockeyEmulator","http://10.0.3.2:8080").constant("loginUrl","/service/login").constant("expensesUrl","/service/expense/:image").constant("currenciesUrl","/service/currencies").constant("expenseTypesUrl","/service/expenseTypes").constant("reportsUrl","/service/expense/report").constant("projectsUrl","/service/expense/project").constant("expensesPath","/expenses").constant("reportsPath","/reports"),angular.module("Modals",[]).config(function(){}),angular.module("Header").controller("HeaderCtrl",["$scope","$location","$modal","editModeNotificationChannelSvc","signOutDialogSvc",function(a,b,c,d,e){a.isEditMode=!1,a.isActive=function(a){return a===b.path()},a.openEditMode=function(){a.isEditMode=!a.isEditMode,d.toggleEditMode(a.isEditMode)},a.signOut=function(){e.open().then(function(a){b.path(a)})}}]),angular.module("Login").controller("LoginCtrl",["$scope","$location","UserSvc","errorMsg","localStorageSvc",function(a,b,c,d,e){a.errorMessage=d,a.showErrorMessage=!1,a.login=function(d){function f(c){e.localStorageExists()?(a.showErrorMessage=!1,e.setItem("session-token",c.session_token),e.setItem("userName",a.user.username),b.path("/expenses")):g()}function g(){a.showErrorMessage=!0,a.user.username="",a.user.password=""}c.login({username:d.username,password:d.password},f,g)}}]),angular.module("Expenses").controller("AddEditExpenseCtrl",["$scope","$location","expensesRepositorySvc","addExpenseErrorMsg","$modal","currenciesSvc","reportsSharingSvc","currencySelectDialogSvc",function(a,b,c,d,e,f,g,h){a.errorMessage=d,a.currencies=f.get(),a.selectCurrency=function(b){h.open(b,a.currencies).then(function(b){a.expense.currency=b})}}]),angular.module("Expenses").controller("ExpensesListCtrl",["$scope","$filter","$location","expenseSvc","expensesRepositorySvc","expensesBufferingSvc","editExpenseSvc","cameraSvc","editModeNotificationChannelSvc","confirmDeleteDialogSvc","reportEntity",function(a,b,c,d,e,f,g,h,i,j,k){function l(b){a.isEditMode=b}a.goToReports=function(){c.path("/reports")};var m=!0;a.expenses=[],a.isEditMode=!1,i.onEditModeToggled(a,l),a.deleteExpense=function(b){j.open(k).then(function(){a.expenses=a.expenses.filter(function(a){return a.expenseId!==b})})},a.showInvoiceImage=function(){c.path("/invoice-expense-image")},a.editExpense=function(b){a.isEditMode||(g.setExpenseForEdit(b),c.path("/edit-expense"))},a.getMoreExpenses=function(){return m?void(m=!1):void f.getMoreExpenses(a).then(function(b){b.forEach(function(b){a.expenses.push(d.getExpense(a,b))})})},a.takePhoto=function(b){a.isEditMode||h.takePhoto().then(function(){b.imageType="jpg"})},f.getExpenses(a).then(function(b){b.forEach(function(b){a.expenses.push(b)})})}]),angular.module("Expenses").controller("EditExpenseCtrl",["$scope","$location","editExpensesTitle","editExpensesButtonLabel","editExpenseSvc","cameraSvc","reportsRepositorySvc","currencySelectDialogSvc","expensesRepositorySvc","editSaveExpenseDialogSvc","expenseReportsDialogSvc","expenseViewImageSvc",function(a,b,c,d,e,f,g,h,i,j,k,l){a.title=c,a.buttonLabel=d,a.showErrorMessage=!1,a.expense=e.getExpenseForEdit(),a.report={},a.imageSelectedPath="","void"!==a.expense.imageType&&i.getImage({},{image:"image"}).$promise.then(function(b){a.imageSelectedPath=b.invoiceImage}),a.save=function(c,d){c.$valid?(d.date=d.date,j.openSuccessEditExpenseDialog(a.report.description).then(function(a){b.path(a)})):a.showErrorMessage=!0},a.selectReport=function(){k.open().then(function(b){a.report=b})},a.date=a.expense.date,a.isEdit=!0,a.cancelPhoto=function(){a.imageSelectedPath=""},a.takePhoto=function(){f.takePhoto().then(function(b){a.imageSelectedPath=b})},a.viewImage=function(){l.open().then(function(){a.takePhoto()},{})}}]),angular.module("Expenses").controller("AddExpenseCtrl",["$scope","$location","addExpensesTitle","addExpensesButtonLabel","reportsSharingSvc","expensesRepositorySvc","editSaveExpenseDialogSvc",function(a,b,c,d,e,f,g){a.title=c,a.buttonLabel=d,a.showErrorMessage=!1,a.expense={},a.report=e.getReport(),a.save=function(c,d){c.$valid?(d.date=new Date,g.openSuccessSaveExpenseDialog().then(function(a){b.path(a)})):a.showErrorMessage=!0}}]),angular.module("Modals").factory("editSaveExpenseDialogSvc",["$modal","expensesPath","reportsPath",function(a,b,c){function d(d){var e=a.open({templateUrl:"scripts/modals/views/edit-expense-dialog.html",controller:["$scope","$modalInstance",function(a,e){a.reportName=d,a.navigateToReports=function(){e.close(c)},a.navigateToExpensesList=function(){e.close(b)}}]});return e.result.then(function(a){return a})}function e(){var b=a.open({templateUrl:"scripts/modals/views//save-expense-dialog.html",controller:["$scope","$modalInstance",function(a,b){a.ok=function(){b.close("ok")}}]});return b.result.then(function(a){return a})}return{openSuccessEditExpenseDialog:d,openSuccessSaveExpenseDialog:e}}]),angular.module("Modals").factory("expenseReportsDialogSvc",["$modal","reportsSharingSvc","filterReportByStateSvc",function(a,b,c){function d(){var d=a.open({templateUrl:"scripts/modals/views/expense-reports-dialog.html",controller:["$scope","$modalInstance",function(a,d){a.reports=[],a.searchedReport=null,b.getReports().then(function(b){a.reports=b.filter(c.checkIfInState)}),a.selectReport=function(a){d.close(a)}}]});return d.result.then(function(a){return a})}return{open:d}}]),angular.module("Modals").factory("sendReportDialogSvc",["$modal",function(a){function b(b){var c=a.open({templateUrl:"scripts/modals/views/send-report-dialog.html",controller:["$scope","$modalInstance",function(a,c){a.reportName=b,a.ok=function(){c.close("ok")}}]});return c.result.then(function(a){return a})}return{open:b}}]),angular.module("Reports").controller("ReportsCtrl",["$scope","$filter","$location","$modal","reportsSharingSvc","editModeNotificationChannelSvc","reportsRepositorySvc","filterReportByStateSvc","entityName","confirmDeleteDialogSvc",function(a,b,c,d,e,f,g,h,i,j){function k(b){a.isEditMode=b}e.getReports().then(function(b){a.reportCollection=b}),a.isEditMode=!1,f.onEditModeToggled(a,k),a.deleteReport=function(b){j.open(i).then(function(){a.reportCollection=a.reportCollection.filter(function(a){return a.expenseReportId!==b.expenseReportId})})},a.viewReport=function(b){a.isEditMode||b.locked||!h.checkIfInState(b)||(e.setReport(b),c.path("/view-report"))}}]),angular.module("Reports").controller("CreateReportCtrl",["$scope","$location","addReportErrorMsg","reportsSharingSvc","projectsRepositorySvc","reportsRepositorySvc","selectProjectsDialogSvc",function(a,b,c,d,e,f,g){function h(b){a.projects=b}function i(a){alert("Failed because: "+a)}a.errorMessage=c,a.showErrorMessage=!1,a.projects=null,a.report={},a.reportData={},a.selectProject=function(b){g.open(b).then(function(b){a.report.project=b})},e.getProjects(h,i),a.save=function(c){c.$valid||(a.showErrorMessage=!0),a.reportData.token=localStorage.getItem("session-token"),a.reportData.expense=void 0,a.reportData.expenseID=void 0,a.reportData.description=c.title,a.reportData.type=c.type,a.reportData.project=c.project,d.setReport(a.reportData),b.path("/edit-report")}}]),angular.module("Reports").controller("ViewReportCtrl",["$scope","$filter","$location","addReportErrorMsg","$modal","reportsSharingSvc","reportExpensesSvc","editExpenseSvc","expensesRepositorySvc","expensesBufferingSvc","confirmDeleteDialogSvc","entityName","sendReportDialogSvc",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.report=f.getReport(),a.errorMessage=d,a.showErrorMessage=!1,a.expenses=[],a.editMode=!1,a.openEditMode=function(){a.editMode=!a.editMode},a.goToEdit=function(){c.path("/edit-report")},a.editExpense=function(b){a.isEditMode||(h.setExpenseForEdit(b),c.path("/edit-expense"))},j.getExpenses(a).then(function(b){b.forEach(function(b){a.expenses.push(b)})}),a.createExpense=function(){c.path("/add-expense")},a.deleteExpense=function(b){k.open(l).then(function(){a.expenses=a.expenses.filter(function(a){return a.expenseId!==b})})},a.addOrEdit=function(){m.open(a.report.description)}}]),angular.module("Reports").controller("EditReportCtrl",["$scope","$filter","$location","addReportErrorMsg","reportsSharingSvc","projectsRepositorySvc","$modal","reportsRepositorySvc","selectProjectsDialogSvc",function(a,b,c,d,e,f,g,h,i){a.errorMessage=d,a.showErrorMessage=!1,a.projects=null,a.report=e.getReport(),a.selectProject=function(b){i.open(b).then(function(b){a.report.project=b})},a.report=e.getReport(),a.save=function(b){b.$valid?c.path("/reports"):a.showErrorMessage=!0}}]),angular.module("InvoiceExpenseImage").controller("InvoiceImageCtrl",["$scope","expensesRepositorySvc",function(a,b){a.viewImage=!1,a.tabImage=function(){a.viewImage=!a.viewImage},b.getImage({},{image:"image"}).$promise.then(function(b){a.invoiceImage=b.invoiceImage})}]),angular.module("AppConfig",[]).constant("foo","stagingFoo"),angular.module("Services",[]).config(function(){}).constant("editModeToggled","TOGGLE_EDIT_MODE"),angular.module("Services").factory("localStorageSvc",[function(){function a(){return window.localStorage}function b(a,b){localStorage.setItem(a,b)}function c(a){return localStorage.getItem(a)}return{localStorageExists:a,setItem:b,getItem:c}}]),angular.module("Services").factory("requestNotificationChannelSvc",["$rootScope",function(a){var b="_START_REQUEST_",c="_END_REQUEST_",d=function(){a.$broadcast(b)},e=function(){a.$broadcast(c)},f=function(a,c){a.$on(b,function(){c()})},g=function(a,b){a.$on(c,function(){b()})};return{requestStarted:d,requestEnded:e,onRequestStarted:f,onRequestEnded:g}}]),angular.module("Services").factory("editModeNotificationChannelSvc",["$rootScope","editModeToggled",function(a,b){var c=function(a,c){a.$on(b,function(a,b){c(b.isEditMode)})},d=function(c){a.$broadcast(b,{isEditMode:c})};return{onEditModeToggled:c,toggleEditMode:d}}]),angular.module("Modals").factory("expenseViewImageSvc",["$modal","$location",function(a,b){function c(){var c=a.open({templateUrl:"scripts/modals/views/expense-view-image.html",controller:["$scope","$modalInstance",function(a,c){a.profileName=localStorage.getItem("userName"),a.selectNew=function(){c.close()},a.view=function(){b.path("/invoice-expense-image"),c.dismiss()}}]});return c.result.then(function(a){return a})}return{open:c}}]),angular.module("Modals").factory("confirmDeleteDialogSvc",["$modal",function(a){function b(b){var c=a.open({templateUrl:"scripts/modals/views/confirm-delete-dialog.html",controller:["$scope","$modalInstance",function(a,c){a.entityName=b,a.ok=function(){c.close("true")},a.cancel=function(){c.dismiss("false")}}]});return c.result.then(function(a){return a})}return{open:b}}]),angular.module("Modals").factory("currencySelectDialogSvc",["$modal",function(a){function b(b,c){var d=a.open({templateUrl:"scripts/modals/views/currency-select-dialog.html",controller:["$scope","$modalInstance",function(a,d){a.currencies=c,b&&a.currencies.forEach(function(a){a.selected=b.id===a.id?!0:!1}),a.select=function(a){b&&(b.selected=!1),a.selected=!0,d.close(a)}}]});return d.result.then(function(a){return a})}return{open:b}}]),angular.module("Services").factory("filterReportByStateSvc",[function(){function a(a){var c=b.indexOf(a.state)>-1;return c}var b=["Draft Expense","Rejected by Finance","Rejected by Manager","Rejected to Submitter"];return{checkIfInState:a}}]),angular.module("Modals").factory("signOutDialogSvc",["$modal","loginPath",function(a,b){function c(){var c=a.open({templateUrl:"scripts/modals/views/sign-out-dialog.html",controller:["$scope","$modalInstance",function(a,c){a.profileName=localStorage.getItem("userName"),a.ok=function(){c.close(b)}}]});return c.result.then(function(a){return a})}return{open:c}}]),angular.module("Services").factory("expenseReportStatesSvc",[function(){function a(){return b}var b=["Approved by Finance","Approved by Manager","Approved by Owner","Cancelled Expense","Draft Expense","Paid","Pending Approval","Pending Owner Approval","Preparing Payment","Rejected by Finance","Rejected by Manager","Rejected to Submitter"];return{getReportStates:a}}]),angular.module("Services").factory("currenciesRepositorySvc",["$resource","baseUrlMockeyWeb","currenciesUrl",function(a,b,c){return a(b+c,{},{getCurrencies:{method:"GET",isArray:!1}})}]),angular.module("Services").factory("currenciesSvc",[function(){function a(){return c}function b(a){a.map(function(a){a.selected=!1}),c=a}var c=[];return{get:a,set:b}}]),angular.module("Expenses").factory("reportExpensesSvc",["$resource","baseUrlMockeyWeb","expensesUrl","reportsSharingSvc",function(a,b,c,d){var e=d.getReport().expenseReportId;return a(b+c+"/?token="+localStorage.getItem("session-token")+"&expenseReportId="+e,{},{getExpenses:{method:"GET",isArray:!1},saveExpense:{method:"POST"},deleteExpense:{method:"DELETE"}})}]),angular.module("Services").factory("expenseTypesRepositorySvc",["$resource","baseUrlMockeyWeb","expenseTypesUrl",function(a,b,c){return a(b+c,{},{getExpenseTypes:{method:"GET",isArray:!1}})}]),angular.module("Services").factory("expenseTypesSvc",[function(){function a(){return c}function b(a){c=a}var c=[];return{get:a,set:b}}]),angular.module("Services").factory("cameraSvc",["$q",function(a){function b(){function b(a){confirm("Upload image to expense?")?d.resolve(a):d.reject()}function c(){alert("Fail"),d.reject()}var d=a.defer();return navigator.camera.getPicture(b,c,{quality:50,targetWidth:100,targetHeight:100,destinationType:Camera.DestinationType.FILE_URI}),d.promise}return{takePhoto:b}}]),angular.module("Services").factory("projectsRepositorySvc",["$resource","baseUrlMockeyWeb","projectsUrl",function(a,b,c){return a(b+c,{},{getProjects:{method:"GET",isArray:!1}})}]),angular.module("Services").factory("projectsSharingSvc",["$q","projectsRepositorySvc",function(a,b){function c(){var c=a.defer();return 0===d.length?b.getProjects().$promise.then(function(a){d=a.projects,c.resolve(d)}):c.resolve(d),c.promise}var d=[];return{getProjects:c}}]),angular.module("Reports").factory("selectProjectsDialogSvc",["$modal","projectsSharingSvc",function(a,b){function c(c){var d=a.open({templateUrl:"scripts/reports/views/select-projects-dialog.html",controller:["$scope","$modalInstance",function(a,d){b.getProjects().then(function(b){a.projects=b,c&&a.projects.forEach(function(a){a.selected=c.id===a.id?!0:!1})}),a.select=function(a){c&&(c.selected=!1),a.selected=!0,d.close(a)}}]});return d.result.then(function(a){return a})}return{open:c}}]),angular.module("Reports").factory("reportsRepositorySvc",["$resource","baseUrlMockeyWeb","reportsUrl",function(a,b,c){return a(b+c+"?token="+localStorage.getItem("session-token"),{},{getReports:{method:"GET",isArray:!0},saveReports:{method:"POST"},editReports:{method:"PUT"},deleteReports:{method:"DELETE"}})}]),angular.module("Reports").factory("reportsSharingSvc",["$q","reportsRepositorySvc",function(a,b){function c(){var c=a.defer();return 0===d.length?b.getReports().$promise.then(function(a){d=a,c.resolve(d)}):c.resolve(d),c.promise}var d=[],e=null;return{setReport:function(a){e=a},getReport:function(){return e},getReports:c}}]),angular.module("Expenses").factory("expenseSvc",["currenciesSvc",function(a){function b(b,c){function d(){var b=a.get();b.some(function(a){return a.id===f.originalCurrencyId?(f.currency=a,!0):void 0}),!f.currency}function e(){d()}var f=this;f.expenseId=c.expenseId,f.submiter=c.submiter,f.owner=c.owner,f.description=c.description,f.invoiceNumber=c.invoiceNumber,f.date=c.date,f.originalCurrencyId=c.originalCurrencyId,f.originalAmount=c.originalAmount,f.exchangeRate=c.exchangeRate,f.expenseTypeName=c.type,f.imageType=c.imageType,f.currency=null,f.expenseType=null,f.showDetails=!1,f.selected=!1,f.enabled=!0,e()}function c(a,c){return new b(a,c)}return{getExpense:c}}]),angular.module("Expenses").factory("expensesBufferingSvc",["expensesRepositorySvc","$q","expenseSvc",function(a,b,c){function d(d){var e=b.defer();return a.getExpenses().$promise.then(function(a){f=a.expenses.map(function(a){return c.getExpense(d,a)}),f=f.splice(0,4),e.resolve(f)}),e.promise}function e(a){var c=b.defer();return f.length>0?(g=f.splice(0,5),c.resolve(g)):d(a).then(function(a){c.resolve(a)}),c.promise}var f=[],g=[];return{getExpenses:d,getMoreExpenses:e}}]),angular.module("Expenses").factory("expensesRepositorySvc",["$resource","baseUrlMockeyWeb","expensesUrl",function(a,b,c){return a(b+c,{image:"@image"},{getExpenses:{method:"GET",isArray:!1},getImage:{method:"GET",isArray:!1},createExpense:{method:"POST"},saveExpense:{method:"PUT"},deleteExpense:{method:"DELETE"}})}]),angular.module("Expenses").factory("editExpenseSvc",[function(){function a(){return e}function b(a){e=a}function c(a){f=a}function d(){return f}var e=null,f=null;return{getExpenseForEdit:a,setExpenseForEdit:b,setReport:c,getReport:d}}]),angular.module("Filters",[]).config(function(){}),angular.module("Directives",[]).config(function(){}),angular.module("Directives").directive("decimalPlaces",function(){return{link:function(a,b){b.bind("keypress",function(a){var b=$(this).val()+(0!==a.charCode?String.fromCharCode(a.charCode):"");0===$(this).val().search(/(.*)\.[0-9][0-9]/)&&b.length>$(this).val().length&&a.preventDefault()})}}}),angular.module("Directives").directive("loading",["requestNotificationChannelSvc",function(a){return{restrict:"E",replace:!0,template:'<div class="msg errorMsg loader"><img src="resources/images/ajax-loader.gif" />LOADING...</div>',link:function(b,c){c.hide();var d=function(){c.show()},e=function(){c.hide()};a.onRequestStarted(b,d),a.onRequestEnded(b,e)}}}]),angular.module("Directives").directive("stopEvent",function(){return{restrict:"A",link:function(a,b,c){b.bind(c.stopEvent,function(a){a.stopPropagation()})}}}),angular.module("Directives").directive("backButton",function(){return{restrict:"A",link:function(a,b){b.on("click",function(){history.back()})}}});