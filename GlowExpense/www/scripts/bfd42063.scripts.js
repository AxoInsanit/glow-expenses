"use strict";var _mainModules=["Services","Directives","ngRoute","ngResource","Header","Login","Expenses","Reports","infinite-scroll","InvoiceExpenseImage","Api","ui.bootstrap"];angular.module("app",_mainModules).config(["$routeProvider","$httpProvider",function(a,b){a.otherwise({redirectTo:"/login"});var c=[];c.push({name:"/login",params:{templateUrl:"./scripts/login/views/login.html",controller:"LoginCtrl"}}),c.push({name:"/expenses",params:{templateUrl:"scripts/expenses/views/expenses.html",controller:"ExpensesListCtrl"}}),c.push({name:"/invoice-expense-image",params:{templateUrl:"scripts/invoice_expense_image/views/invoice-image-details.html",controller:"InvoiceImageCtrl"}}),c.push({name:"/add-expense",params:{templateUrl:"scripts/expenses/views/add-edit-expense.html",controller:"AddExpenseCtrl"}}),c.push({name:"/edit-expense",params:{templateUrl:"scripts/expenses/views/add-edit-expense.html",controller:"EditExpenseCtrl"}}),c.push({name:"/reports",params:{templateUrl:"scripts/reports/views/main-report-view.html",controller:"ReportsCtrl"}}),c.push({name:"/create-report",params:{templateUrl:"scripts/reports/views/create-report.html",controller:"CreateReportCtrl"}}),c.push({name:"/edit-report",params:{templateUrl:"scripts/reports/views/edit-report.html",controller:"EditReportCtrl"}}),c.push({name:"/view-report",params:{templateUrl:"scripts/reports/views/view-report.html",controller:"ViewReportCtrl"}}),c.push({name:"/settings",params:{templateUrl:"scripts/expenses/views/settings.html",controller:"LoginCtrl"}}),c.forEach(function(b){a.when(b.name,b.params)});var d,e=["$q","$injector",function(a,b){function c(a){return d=d||b.get("$http"),d.pendingRequests.length<1&&(f=f||b.get("requestNotificationChannelSvc"),f.requestEnded()),a}function e(c){return d=d||b.get("$http"),d.pendingRequests.length<1&&(f=f||b.get("requestNotificationChannelSvc"),f.requestEnded()),a.reject(c)}var f;return function(a){return f=f||b.get("requestNotificationChannelSvc"),f.requestStarted(),a.then(c,e)}}];b.responseInterceptors.push(e)}]).run(["currenciesRepositorySvc","currenciesSvc","expenseTypesRepositorySvc","expenseTypesSvc",function(a,b,c,d){a.getCurrencies().$promise.then(function(a){b.set(a.currencies)}),c.getExpenseTypes().$promise.then(function(a){d.set(a.expenseTypes)})}]),angular.module("Login",["ngResource"]).config(function(){}).constant("errorMsg","Please try again! Username or password is wrong!"),angular.module("Login").factory("UserSvc",["$resource","baseUrlMockeyWeb","loginUrl",function(a,b,c){return a(b+c,{},{login:{method:"POST"}})}]),angular.module("Header",[]).config(function(){}).constant("defaultMode","_DEFAULT_").constant("selectMode","_SELECT_").constant("selectModeActivated","_SELECT_MODE_ACTIVATED").constant("detailsModeActivated","_DETAILS_MODE_ACTIVATED").constant("addExpenseErrorMsg","Please complete all fields!"),angular.module("Expenses",[]).config(function(){}).constant("defaultMode","_DEFAULT_").constant("selectMode","_SELECT_").constant("selectModeActivated","_SELECT_MODE_ACTIVATED").constant("detailsModeActivated","_DETAILS_MODE_ACTIVATED").constant("addExpenseErrorMsg","Please complete all fields!").constant("addExpensesTitle","Add Expenses").constant("addExpensesButtonLabel","Create").constant("editExpensesTitle","Edit Expenses").constant("editExpensesButtonLabel","Save"),angular.module("Reports",[]).config(function(){}).constant("defaultMode","_DEFAULT_").constant("selectMode","_SELECT_").constant("selectModeActivated","_SELECT_MODE_ACTIVATED").constant("detailsModeActivated","_DETAILS_MODE_ACTIVATED").constant("addReportErrorMsg","Please complete all fields!"),angular.module("InvoiceExpenseImage",[]).config(function(){}),angular.module("Api",[]).config(function(){}).constant("baseUrl","https://esb.dev.corp.globant.com").constant("baseUrlMockeyWeb","http://10.0.3.2:8080").constant("baseUrlMockeyEmulator","http://10.0.3.2:8080").constant("loginUrl","/service/login").constant("expensesUrl","/service/expense/:image").constant("currenciesUrl","/service/currencies").constant("expenseTypesUrl","/service/expenseTypes").constant("reportsUrl","/service/expese/report").constant("projectsUrl","/service/expese/project"),angular.module("Header").controller("HeaderCtrl",["$scope","$filter","$location","$modal",function(a,b,c,d){a.editMode=!1,a.isActive=function(a){return a===c.path()},a.addExpense=function(){c.path("/add-expense")},a.openEditMode=function(){a.editMode=!a.editMode,a.$emit("EditList",a.editMode)},a.openProfile=function(){var b=d.open({templateUrl:"signOutModal",controller:SignOutModalCtrl,size:"sm",resolve:{items:function(){return a.items}}});b.result}}]),angular.module("Login").controller("LoginCtrl",["$scope","$location","UserSvc","errorMsg","localStorageSvc",function(a,b,c,d,e){a.errorMessage=d,a.showErrorMessage=!1,a.login=function(d){function f(c){e.localStorageExists()?(a.showErrorMessage=!1,e.setItem("session-token",c.session_token),e.setItem("userName",a.user.username),b.path("/expenses")):g()}function g(){a.showErrorMessage=!0,a.user.username="",a.user.password=""}c.login({username:d.username,password:d.password},f,g)}}]),angular.module("Expenses").controller("AddEditExpenseCtrl",["$scope","$location","expensesRepositorySvc","addExpenseErrorMsg","$modal","currenciesSvc","expenseTypesSvc","reportSharingSvc",function(a,b,c,d,e,f,g,h){a.errorMessage=d,a.showErrorMessage=!1,a.report=h.getReport().data,a.selectedReport=null,a.currencies=f.get(),a.expenseTypes=g.get(),a.isEditExpense=!1,b.$$path.indexOf("edit-")>0&&(a.isEditExpense=!0),a.createReport=function(){b.path("/create-report")},a.expenseTypeModal=function(){e.open({templateUrl:"expenseTypeModal",controller:expenseTypeModalCtrl,resolve:{expenseTypes:function(){return{types:a.expenseTypes,target:event.target}}}})},a.expenseCurrencyModal=function(){e.open({templateUrl:"expenseCurrencyModal",controller:expenseCurrencyModalCtrl,resolve:{currencies:function(){return{types:a.currencies,target:event.target}}}})},a.selectReport=function(b){a.selectedReport=b},a.addOrEdit=function(b,d){function f(){a.showErrorMessage=!1,e.open({templateUrl:"editSaveExpenseModal",controller:editSaveCtrl,resolve:{data:function(){return{report:a.report}}}})}function g(){a.showErrorMessage=!0}d.reportId=a.selectedReport,b.$valid?(d.date=d.date||new Date,c.saveExpense(d,f,g)):a.showErrorMessage=!0}}]),angular.module("Expenses").controller("ExpensesListCtrl",["$scope","$filter","$location","expenseSvc","expensesRepositorySvc","expensesBufferingSvc","defaultMode","selectMode","editExpenseSvc","cameraSvc","$modal",function(a,b,c,d,e,f,g,h,i,j,k){function l(b,c){a.expenses=o(a.expenses,b,c)}var m=g,n=!0;a.isMain=!0,a.expenses=[],a.searchedExpense={},a.showSorting=!1,a.reverseSorting=!0,a.showSearch=!1,a.showDeleteMode=!1,a.showEditMode=!1,a.repository=e,a.expenseForDeletion=null,a.$on("EditList",function(b,c){a.showEditMode=c}),a.deleteExpense=function(b,c){a.expenseForDeletion=b;var d=k.open({templateUrl:"deleteModal",controller:"deleteExpModalCtrl",size:"sm",resolve:{}});d.result.then(function(){function b(a){a.getExpenses()}function d(a){alert("Failed because: "+a)}c.deleteExpense({token:localStorage.getItem("session-token"),expenseId:a.expenseForDeletion.expenseId},b(c),d())},function(){})},a.takePhoto=function(){function b(b){a.imageSelectedPath=b}function c(a){alert("Failed because: "+a)}navigator.camera.getPicture(b,c,{quality:50,destinationType:Camera.DestinationType.FILE_URI,targetWidth:50,targetHeight:50})},a.showInvoiceImage=function(){c.path("/invoice-expense-image")},a.editExpense=function(b){a.showEditMode||(i.setExpenseForEdit(b),c.path("/edit-expense"))},a.selectMode=function(){return m===h},a.getMoreExpenses=function(){return n?void(n=!1):void f.getMoreExpenses(a).then(function(b){b.forEach(function(b){a.expenses.push(d.getExpense(a,b))})})},a.enableSorting=function(){a.showSorting=!0},a.sort=function(b){a.reverseSorting=b,l("date",b),a.showSorting=!1},a.toggleSearching=function(b){a.showSearch=b},a.takePhoto=function(a){j.takePhoto().then(function(){a.imageType="jpg"})};var o=b("orderBy");f.getExpenses(a).then(function(b){b.forEach(function(b){a.expenses.push(b)})})}]),angular.module("Expenses").controller("EditExpenseCtrl",["$scope","editExpensesTitle","editExpensesButtonLabel","editExpenseSvc","cameraSvc","reportsRepositorySvc",function(a,b,c,d,e,f){function g(b){a.reportCollection=b}function h(a){alert("Failed because: "+a)}a.title=b,a.buttonLabel=c,a.expense=d.getExpenseForEdit(),a.report=null,a.reportCollection=null,a.haveReport=void 0!=d.getReport(),a.createReport=function(){$location.path("/create-report")},a.date=a.expense.date,a.isEdit=!0,a.imageSelectedPath="",a.haveReport?(a.report=d.getReport(),d.setReport(void 0)):f.getReports(g,h),a.takePhoto=function(){e.takePhoto().then(function(b){a.imageSelectedPath=b})}}]),angular.module("Expenses").controller("AddExpenseCtrl",["$scope","addExpensesTitle","addExpensesButtonLabel",function(a,b,c){a.title=b,a.buttonLabel=c,a.date=new Date}]),angular.module("Reports").controller("ReportsCtrl",["$scope","$filter","$location","reportsRepositorySvc","$modal","reportSharingSvc",function(a,b,c,d,e,f){function g(b){a.reportCollection=b}function h(a){alert("Failed because: "+a)}a.isMain=!0,a.reportCollection={},a.showEditMode=!1,a.$on("EditList",function(b,c){a.showEditMode=c}),a.deleteReport=function(b){a.reportForDeletion=b;var c=e.open({templateUrl:"deleteModal",controller:"deleteExpModalCtrl",size:"sm",resolve:{}});c.result.then(function(){function b(a){a.getReports()}function c(a){alert("Failed because: "+a)}d.deleteReports({token:localStorage.getItem("session-token"),expenseReportId:a.reportForDeletion.expenseReportId},b(d),c())},function(){})},a.viewReport=function(b){a.showEditMode||b.locked||(f.setReport(b),c.path("/view-report"))},a.createReport=function(){c.path("/create-report")},d.getReports(g,h)}]),angular.module("Reports").controller("CreateReportCtrl",["$scope","$filter","$location","addReportErrorMsg","reportSharingSvc","projectRepositorySvc","$modal","reportsRepositorySvc",function(a,b,c,d,e,f,g,h){function i(b){a.projects=b}function j(a){alert("Failed because: "+a)}function k(){c.path("/reports")}function l(a){alert("Failed because: "+a)}a.errorMessage=d,a.showErrorMessage=!1,a.projects=null,a.projectNameModal=function(){var b=g.open({templateUrl:"projectNameModal",controller:"projectNameModalCtrl",size:"sm",resolve:{data:function(){return{projects:a.projects,target:event.target}}}});b.result.then(function(){},function(){})},f.getProjects(i,j),a.save=function(){h.saveReports({},k,l)}}]),angular.module("Reports").controller("ViewReportCtrl",["$scope","$filter","$location","addReportErrorMsg","$modal","reportSharingSvc","reportExpensesSvc","editExpenseSvc","expensesRepositorySvc",function(a,b,c,d,e,f,g,h,i){function j(b){a.expenses=b}function k(a){alert("Failed because: "+a)}a.report=f.getReport().data,a.errorMessage=d,a.showErrorMessage=!1,a.expenses=[],a.editMode=!1,a.openEditMode=function(){a.editMode=!a.editMode},a.editExpense=function(b){a.editMode||(h.setExpenseForEdit(b),h.setReport(a.report),c.path("/edit-expense"))},a.goToEdit=function(){c.path("/edit-report")},g.getExpenses(j,k),a.createExpense=function(){c.path("/add-expense")},a.deleteExpense=function(b){a.expenseForDeletion=b.expenseId;var c=e.open({templateUrl:"deleteModal",controller:"deleteExpModalCtrl",size:"sm",resolve:{}});c.result.then(function(){function b(){g.getExpenses(b,c)}function c(a){alert("Failed because: "+a)}i.deleteExpense({token:localStorage.getItem("session-token"),expenseId:a.expenseForDeletion},b(),c())},function(){})},a.addOrEdit=function(){e.open({templateUrl:"createModal",controller:successModalCtrl,resolve:{data:function(){return{expenses:a.report}}}})}}]),angular.module("Reports").controller("EditReportCtrl",["$scope","$filter","$location","addReportErrorMsg","reportSharingSvc","projectRepositorySvc","$modal","reportsRepositorySvc",function(a,b,c,d,e,f,g,h){function i(b){a.projects=b}function j(a){alert("Failed because: "+a)}function k(){c.path("/view-report")}function l(a){alert("Failed because: "+a)}a.errorMessage=d,a.showErrorMessage=!1,a.projects=null,a.projectNameModal=function(){var b=g.open({templateUrl:"projectNameModal",controller:"projectNameModalCtrl",size:"sm",resolve:{data:function(){return{projects:a.projects,target:event.target}}}});b.result.then(function(){},function(){})},f.getProjects(i,j),a.report=e.getReport().data,a.save=function(){h.editReports({},k,l)}}]);var SignOutModalCtrl=function(a,b,c,d,e){a.profileName=localStorage.getItem("userName"),a.ok=function(){localStorage.setItem("session-token",null),e.path("/login"),b.dismiss("cancel")}};angular.module("Expenses").controller("deleteExpModalCtrl",["$scope","$modalInstance","$location",function(a,b,c){a.location=function(){return c.$$path.indexOf("report")>0?"report":"expense"},a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]);var expenseTypeModalCtrl=function(a,b,c){a.expenses=c.types,a.target=c.target,a.chousen=function(c){$(a.target).html(c.name),$.grep(a.expenses,function(a){1==a.selected,a.selected=!1}),c.selected=!0,b.dismiss("cancel")}},expenseCurrencyModalCtrl=function(a,b,c){a.currencies=c.types,a.target=c.target,a.chousen=function(c){$(a.target).html(c.name),$.grep(a.currencies,function(a){1==a.selected,a.selected=!1}),c.selected=!0,b.dismiss("cancel")}},successModalCtrl=function(a,b,c){a.saveEditTitle=c.expenses.description,a.text=""},editSaveCtrl=function(a,b,c,d){a.text=d.$$path.indexOf("edit")>0?"edited":"added to "+c.report.description,a.goToReports=function(){d.path("/reports"),b.dismiss("cancel")},a.goToExpensesList=function(){d.path("/expenses"),b.dismiss("cancel")}};angular.module("Reports").controller("projectNameModalCtrl",["$scope","$modalInstance","$location","data",function(a,b,c,d){a.projects=d.projects.projects,a.target=d.target,a.chousen=function(c){$(a.target).html(c.name),$.grep(a.projects,function(a){1==a.selected,a.selected=!1}),c.selected=!0,b.dismiss("cancel")}}]),angular.module("InvoiceExpenseImage").controller("InvoiceImageCtrl",["$scope","expensesRepositorySvc",function(a,b){b.getImage({},{image:"image"}).$promise.then(function(b){a.invoiceImage=b.invoiceImage})}]),angular.module("AppConfig",[]).constant("foo","stagingFoo"),angular.module("Services",[]).config(function(){}).constant("currenciesUrl","https://esb.dev.corp.globant.com/currency").constant("currenciesUrlMockWeb","http://127.0.0.1:8080/service/currencies"),angular.module("Services").factory("localStorageSvc",[function(){function a(){return window.localStorage}function b(a,b){localStorage.setItem(a,b)}function c(a){return localStorage.getItem(a)}return{localStorageExists:a,setItem:b,getItem:c}}]),angular.module("Services").factory("requestNotificationChannelSvc",["$rootScope",function(a){var b="_START_REQUEST_",c="_END_REQUEST_",d=function(){a.$broadcast(b)},e=function(){a.$broadcast(c)},f=function(a,c){a.$on(b,function(){c()})},g=function(a,b){a.$on(c,function(){b()})};return{requestStarted:d,requestEnded:e,onRequestStarted:f,onRequestEnded:g}}]),angular.module("Services").factory("currenciesRepositorySvc",["$resource","baseUrlMockeyWeb","currenciesUrl",function(a,b,c){return a(b+c,{},{getCurrencies:{method:"GET",isArray:!1}})}]),angular.module("Services").factory("currenciesSvc",[function(){function a(){return c}function b(a){c=a}var c=[];return{get:a,set:b}}]),angular.module("Expenses").factory("reportExpensesSvc",["$resource","baseUrlMockeyWeb","expensesUrl","reportSharingSvc",function(a,b,c,d){var e=d.getReport().data.expenseReportId;return a(b+c+"/?token="+localStorage.getItem("session-token")+"&expenseReportId="+e,{},{getExpenses:{method:"GET",isArray:!0},saveExpense:{method:"POST"},deleteExpense:{method:"DELETE"}})}]),angular.module("Services").factory("expenseTypesRepositorySvc",["$resource","baseUrlMockeyWeb","expenseTypesUrl",function(a,b,c){return a(b+c,{},{getExpenseTypes:{method:"GET",isArray:!1}})}]),angular.module("Services").factory("expenseTypesSvc",[function(){function a(){return c}function b(a){c=a}var c=[];return{get:a,set:b}}]),angular.module("Services").factory("cameraSvc",["$q",function(a){function b(){function b(a){confirm("Upload image to expense?")?d.resolve(a):d.reject()}function c(){alert("Fail"),d.reject()}var d=a.defer();return alert("navigator.camera is "+navigator.camera),navigator.camera.getPicture(b,c,{quality:50,targetWidth:100,targetHeight:100,destinationType:Camera.DestinationType.FILE_URI}),d.promise}return{takePhoto:b}}]),angular.module("Services").factory("projectRepositorySvc",["$resource","baseUrlMockeyWeb","projectsUrl",function(a,b,c){return a(b+c,{},{getProjects:{method:"GET",isArray:!1}})}]),angular.module("Reports").factory("reportsRepositorySvc",["$resource","baseUrlMockeyWeb","reportsUrl",function(a,b,c){return a(b+c,{},{getReports:{method:"GET",isArray:!0},saveReports:{method:"POST",isArray:!0},editReports:{method:"PUT",isArray:!0},deleteReports:{method:"DELETE",isArray:!0}})}]),angular.module("Reports").factory("reportsSvc",["expensesRequestNotificationChannelSvc","currenciesSvc","expenseTypesSvc",function(a){function b(a,b){return new Expense(a,b)}return Expense.prototype.toggleDetails=function(){this.enabled&&(this.selected=!1,this.showDetails=!this.showDetails,a.activateDetailsMode(this.expenseId,this.showDetails))},Expense.prototype.toggleSelect=function(){this.enabled&&!this.showDetails&&(this.selected=!this.selected)},{getExpense:b}}]),angular.module("Reports").factory("reportSharingSvc",function(){var a={data:"test object value"};return{setReport:function(b){a.data=b},getReport:function(){return a}}}),angular.module("Expenses").factory("expenseSvc",["expensesRequestNotificationChannelSvc","currenciesSvc","expenseTypesSvc",function(a,b,c){function d(d,e){function f(){var a=b.get();a.some(function(a){return a.id===k.originalCurrencyId?(k.currency=a,!0):void 0}),!k.currency}function g(){var a=c.get();a.some(function(a){return a.name===k.expenseTypeName?(k.expenseType=a,!0):void 0}),!k.expenseType}function h(){k.showDetails=!1}function i(a,b){k.expenseId!==a&&(b?(k.showDetails=!1,k.enabled=!1):k.enabled=!0)}function j(){f(),g(),a.onSelectModeActivated(d,h),a.onDetailsModeActivated(d,i)}var k=this;k.expenseId=e.expenseId,k.submiter=e.submiter,k.owner=e.owner,k.description=e.description,k.invoiceNumber=e.invoiceNumber,k.date=e.date,k.originalCurrencyId=e.originalCurrencyId,k.originalAmount=e.originalAmount,k.exchangeRate=e.exchangeRate,k.expenseTypeName=e.type,k.imageType=e.imageType,k.currency=null,k.expenseType=null,k.showDetails=!1,k.selected=!1,k.enabled=!0,j()}function e(a,b){return new d(a,b)}return d.prototype.toggleDetails=function(){this.enabled&&(this.selected=!1,this.showDetails=!this.showDetails,a.activateDetailsMode(this.expenseId,this.showDetails))},d.prototype.toggleSelect=function(){this.enabled&&!this.showDetails&&(this.selected=!this.selected)},{getExpense:e}}]),angular.module("Expenses").factory("expensesBufferingSvc",["expensesRepositorySvc","$q","expenseSvc",function(a,b,c){function d(d){var e=b.defer();return a.getExpenses().$promise.then(function(a){f=a.expenses.map(function(a){return c.getExpense(d,a)}),f=f.splice(0,4),e.resolve(f)}),e.promise}function e(a){var c=b.defer();return f.length>0?(g=f.splice(0,5),c.resolve(g)):d(a).then(function(a){c.resolve(a)}),c.promise}var f=[],g=[];return{getExpenses:d,getMoreExpenses:e}}]),angular.module("Expenses").factory("expensesRepositorySvc",["$resource","baseUrlMockeyWeb","expensesUrl",function(a,b,c){return a(b+c,{image:"@image"},{getExpenses:{method:"GET",isArray:!1},getImage:{method:"GET",isArray:!1},saveExpense:{method:"POST"},deleteExpense:{method:"DELETE"}})}]),angular.module("Expenses").factory("expensesRequestNotificationChannelSvc",["$rootScope","selectModeActivated","detailsModeActivated",function(a,b,c){var d=function(){a.$broadcast(b)},e=function(a,c){a.$on(b,function(){c()})},f=function(b,d){a.$broadcast(c,{expenseId:b,isAnotherExpenseOpened:d})},g=function(a,b){a.$on(c,function(a,c){b(c.expenseId,c.isAnotherExpenseOpened)})};return{activateSelectMode:d,onSelectModeActivated:e,activateDetailsMode:f,onDetailsModeActivated:g}}]),angular.module("Expenses").factory("editExpenseSvc",[function(){function a(){return e}function b(a){e=a}function c(a){f=a}function d(){return f}var e=null,f=null;return{getExpenseForEdit:a,setExpenseForEdit:b,setReport:c,getReport:d}}]),angular.module("Filters",[]).config(function(){}),angular.module("Directives",[]).config(function(){}),angular.module("Directives").directive("decimalPlaces",function(){return{link:function(a,b){b.bind("keypress",function(a){var b=$(this).val()+(0!==a.charCode?String.fromCharCode(a.charCode):"");0===$(this).val().search(/(.*)\.[0-9][0-9]/)&&b.length>$(this).val().length&&a.preventDefault()})}}}),angular.module("Directives").directive("loading",["requestNotificationChannelSvc",function(a){return{restrict:"E",replace:!0,template:'<div class="msg errorMsg loader"><img src="resources/images/ajax-loader.gif" />LOADING...</div>',link:function(b,c){c.hide();var d=function(){c.show()},e=function(){c.hide()};a.onRequestStarted(b,d),a.onRequestEnded(b,e)}}}]),angular.module("Directives").directive("stopEvent",function(){return{restrict:"A",link:function(a,b,c){b.bind(c.stopEvent,function(a){a.stopPropagation()})}}}),angular.module("Directives").directive("backButton",function(){return{restrict:"A",link:function(a,b){b.on("click",function(){history.back()})}}});